<!DOCTYPE html>
<meta http-equiv="refresh" content="3">
<meta charset="utf-8">
<style>

    .chart rect {
        fill: steelblue;
    }

    .chart text {
        fill: white;
        font: 10px sans-serif;
    }

</style>
<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
    var width = 420,
            barHeight = 20;

    var x = d3.scale.linear()
            .range([0, width]);

    var chart = d3.select(".chart")
            .attr("width", width);

    d3.json("http://localhost:8080/rest-api/services/analytics", function (error, data) {
        var perf = data.performances;
        x.domain([0, d3.max(perf, function (d) {
            return d.avgRunningSpeed;
        })]);

        chart.attr("height", barHeight * perf.length);

        var bar = chart.selectAll("g")
                .data(perf)
                .enter().append("g")
                .attr("transform", function (d, i) {
                    return "translate(0," + i * barHeight + ")";
                });

        bar.append("text")
                .attr("x", 0)
                .attr("y", barHeight / 2)
                .attr("dy", ".35em")
                .attr("style", "fill:black")
                .text(function (d) {
                    return d.name;
                });

        bar.append("rect")
                .attr("x", 100)
                .attr("width", function (d) {
                    return x(d.avgRunningSpeed);
                })
                .attr("height", barHeight - 1);

        bar.append("text")
                .attr("x", function (d) {
                    return 100 + x(d.avgRunningSpeed) - 3;
                })
                .attr("y", barHeight / 2)
                .attr("dy", ".35em")
                .attr("text-anchor", "end")
                .text(function (d) {
                    return d.avgRunningSpeed;
                });
    });

    function type(d) {
        console.log(d)
        d.value = +d.avgRunningSpeed; // coerce to number
        return d;
    }

</script>